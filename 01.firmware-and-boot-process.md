# Firmware and Boot Process

## 1. Introduction to Booting

### 1.1 What is Booting?

- Booting is the process by which a computer starts up.
- The booting process initializes hardware, and loads the operating system into memory so it can run.

### 1.2 The Complete Boot Process Overview

```bash
Power ON
   ↓
Firmware (BIOS / UEFI)
   ↓
POST (Power-On Self Test)
   ↓
Bootloader (e.g., GRUB)
   ↓
Kernel (core of OS)
   ↓
Init / Systemd (starts system services)
   ↓
User Space (login, desktop, shell)
```

## 2. Stage 1- Power ON

### 2.1 What happens when a user powers on a computer?

- User presses the power button.
- PSU (Power Supply Unit) sends electricity to motherboard and its components.
- CPU starts executing code from a predefined memory location.
- This code is part of the firmware (BIOS/UEFI).
- So, the very first code that runs is not from the SSD or OS — it’s from firmware stored on the motherboard.

## 3. Stage 2- Firmware (BIOS / UEFI)

### 3.1 What is Firmware?

- Firmware is low-level software stored on a non-volatile chip (ROM/Flash memory) on your motherboard.
- It’s the bridge between hardware and the operating system.
- Common types of firmware are BIOS (Basic Input/Output System) and UEFI (Unified Extensible Firmware Interface).

### 3.2 BIOS vs UEFI

#### 3.2.1 BIOS

- Stands for Basic Input Output System.
- The older firmware standard.
- Stored in a ROM chip.
- Operates in 16-bit real mode.
- Uses MBR (Master Boot Record) partition scheme.
- Limited to booting drives ≤ 2 TB.

#### 3.2.2 UEFI

- Stands for Unified Extensible Firmware Interface.
- The modern replacement for BIOS.
- Stored in flash memory.
- Operates in 32-bit or 64-bit mode.
- Uses GPT (GUID Partition Table) — supports drives > 2 TB.
- Has graphical interface and mouse support.
- Can access network & secure boot options.

### 3.3 Firmware Responsibilities

| Task | Description |
| - | - |
| Power-on initialization | Activates CPU, memory, storage, and I/O |
| POST (Power-On Self-Test) | Checks if essential components work properly |
| Boot Device Selection | Chooses where to boot from (SSD, USB, Network) |
| Loads Bootloader | Reads bootloader file from selected device |
| Passes Control | Hands over control to the bootloader |

### 3.4 Accessing BIOS/UEFI

- At startup, press:
  - F2 or DEL (common for laptops like HP/ASUS).
  - ESC, F10, or F12 (depends on model).
- You’ll enter the firmware setup utility.

## 4. Stage 3- POST (Power-On Self Test)

### 4.1 What is POST?

- POST is a diagnostic testing sequence run by the firmware.
- It checks the essential hardware components (RAM, CPU, GPU, storage devices).
- If all tests pass, the boot process continues.
- If a test fails, it may produce beep codes or error messages.

### 4.2 Common POST Errors

| Error Type | Description | Possible Fixes |
| - | - | - |
| Beep Codes | Series of beeps indicating hardware issues | Check motherboard manual for beep code meanings |
| No Display | Monitor remains blank | Check GPU connection, reseat RAM |
| Keyboard/Mouse Not Detected | Peripherals not recognized | Try different USB ports or replace devices |
| Hard Drive Not Detected | Storage device not found | Check SATA/Power cables, BIOS settings |

## 5. Stage 4- Bootloader

- Once firmware confirms hardware is OK, it loads a small program from the bootable device.
This program is called the Bootloader.

### 5.1 What is a Bootloader?

- A bootloader is a small software program that:
  - Locates the operating system kernel.
  - Loads it into memory.
  - Passes control to it.
- In Linux systems, the most common bootloader is GRUB (GNU GRand Unified Bootloader).

### 5.2 GRUB Bootloader

- GRUB allows users to choose between multiple operating systems or kernel versions at startup.
- It can be customized via configuration files (e.g., `/etc/default/grub`).
- GRUB supports various filesystems and can load kernels from different partitions.

### 5.3 GRUB Stages

| Stage | Function |
| - | - |
| **Stage 1** | Resides in MBR/GPT boot sector. Points to next stage. |
| **Stage 1.5 / 2** | Resides in `/boot/grub/` directory. Loads GRUB modules & config. |
| **Stage 3** | Loads the kernel (`vmlinuz`) and initial RAM disk (`initrd`). |

- BIOS (legacy) boot:
  - Stage 1 (MBR): tiny code in the Master Boot Record (first 446 bytes). Very small — its only job is to load the next piece of GRUB.
  - Stage 1.5 (optional, "core.img"): lives in the disk gap or embedded area. Contains filesystem drivers needed to read /boot; it loads the full GRUB.
  - Stage 2 (grub core / full GRUB): the real GRUB program with menu, filesystem drivers and modules. It reads the configuration (usually /boot/grub/grub.cfg), shows the boot menu, loads the chosen kernel and initrd into memory, and hands control to the kernel.

- UEFI boot:
  - Firmware loads an EFI executable (for example grubx64.efi) from the EFI System Partition.
  - That EFI executable contains GRUB’s core and modules (no separate 1.5 step). It reads grub.cfg, shows the menu, loads kernel + initrd, and transfers control to the kernel.

- Key points:
  - Stage 1 is tiny and just finds the next code to run.
  - Stage 1.5/core provides filesystem access so GRUB can read kernels/config files.
  - Stage 2 is where the menu, modules, and kernel-loading logic live.

## 6. Stage 5- Kernel Loading

### 6.1 What is a Kernel?

- The kernel is the core of the operating system.
- It acts as a bridge between software and hardware.
- It manages:
  - CPU time
  - Memory
  - Devices (through drivers)
  - System calls (communication with user-space programs).

### 6.2 Kernel loading steps

- GRUB loads kernel file (vmlinuz-...) into memory.
- GRUB loads initrd (Initial RAM Disk) — temporary filesystem to help kernel load drivers.
- Kernel decompresses itself.
- Kernel detects hardware & loads necessary modules.
- Kernel mounts the real root filesystem (like /dev/sda2).
- Control is handed to the init system (next stage).

## 7. Stage 6- INIT/SYSTEMD (User space startup)

- Once the kernel is ready, it starts the first user-space process, traditionally called init.
- In modern Linux (like Ubuntu 24.04), the init system is systemd.

### 7.1 What is Systemd?

- Systemd is a system and service manager — it brings the system from “kernel mode” to “user mode”.
- It does the following:
  - Mounts file systems.
  - Starts services (like network, Bluetooth, display).
  - Handles login sessions.
  - Tracks background processes.

## 8. Stage 7- User Space

### 8.1 What happens after systemd completes services

- Finally, after systemd completes service initialization:
- Login prompts (TTY or GUI) appear.
- Desktop environment (like GNOME) starts.
- User can now run applications and commands.

### Example: What happens when user log in

- Systemd starts gdm (GNOME Display Manager).
- User enters the password.
- User's user session starts.
- Desktop environment loads panels, icons, etc.
- User now in user space, ready to work.

## 9. The Boot Process Recap

- Power Button → Power to CPU
- Firmware (BIOS/UEFI) runs → POST check
- Bootloader (GRUB) → loads kernel
- Kernel → initializes hardware, mounts root FS
- systemd → starts services, login manager
- User → logs in → uses applications
